name: Update www branch for GitHub Pages

# This workflow creates and maintains the 'www' branch for GitHub Pages
# It can be triggered manually to create the branch if it doesn't exist

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'docs/**'

jobs:
  update-www-branch:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: Create or update www branch
        run: |
          # Check if www branch exists remotely
          if git ls-remote --heads origin www | grep www; then
            echo "www branch exists, checking out"
            git checkout www
            git pull origin www
          else
            echo "Creating new www branch"
            git checkout -b www
          fi
          
          # Ensure docs/index.html exists
          if [ ! -f docs/index.html ]; then
            echo "Creating docs/index.html"
            cat > docs/index.html << 'EOF'
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenDleto - GitHub Pages</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        .welcome-box {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
        }
        .info-section {
            background-color: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        code {
            background-color: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .setup-instructions {
            background-color: #fffbea;
            border: 1px solid #f9e79f;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        .setup-instructions h2 {
            color: #856404;
            margin-top: 0;
        }
        ol {
            padding-left: 20px;
        }
        li {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="welcome-box">
        <h1>Welcome to OpenDleto's GitHub Pages site!</h1>
        <p>This is the official GitHub Pages site for the OpenDleto project - a package of tools to carve information out of tensor data.</p>
    </div>

    <div class="info-section">
        <h2>About OpenDleto</h2>
        <p><strong>Dleto</strong>, which means chisel, is a package of tools to carve information out of tensor data. Using the algebra of operators on tensors, Dleto methods determine change of coordinates relative to which tensor data is supported on a smaller valence.</p>
        <p>Visit the main repository: <a href="https://github.com/thetensor-space/OpenDleto">github.com/thetensor-space/OpenDleto</a></p>
        <p>More information: <a href="https://TheTensor.Space/">TheTensor.Space</a></p>
    </div>

    <div class="setup-instructions">
        <h2>ðŸ“‹ GitHub Pages Setup Instructions</h2>
        <p>This site is configured to serve from the <code>/docs</code> folder on the <code>www</code> branch.</p>
        
        <h3>To enable GitHub Pages for this repository:</h3>
        <ol>
            <li>Navigate to the repository's <strong>Settings</strong> page</li>
            <li>In the left sidebar, click on <strong>Pages</strong> under the "Code and automation" section</li>
            <li>Under <strong>Source</strong>, select <strong>Deploy from a branch</strong></li>
            <li>Under <strong>Branch</strong>:
                <ul>
                    <li>Select the <code>www</code> branch from the dropdown</li>
                    <li>Select <code>/docs</code> as the folder</li>
                    <li>Click <strong>Save</strong></li>
                </ul>
            </li>
            <li>Wait a few moments for GitHub to build and deploy the site</li>
            <li>Your site will be published at: <code>https://thetensor-space.github.io/OpenDleto/</code></li>
        </ol>

        <h3>Note:</h3>
        <p>The <code>www</code> branch has been created specifically for GitHub Pages hosting. This keeps the documentation site separate from the main development branches.</p>
    </div>

    <div class="info-section">
        <h2>Documentation</h2>
        <p>For installation and usage instructions, please refer to:</p>
        <ul>
            <li><a href="Installing-Dleto.md">Installing Dleto</a></li>
            <li><a href="https://github.com/thetensor-space/OpenDleto/blob/main/README.md">Project README</a></li>
        </ul>
    </div>

    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e1e4e8; text-align: center; color: #666;">
        <p>&copy; 2024 TheTensor.Space | OpenDleto Project</p>
    </footer>
</body>
</html>
EOF
            git add docs/index.html
            git commit -m "Add GitHub Pages index.html"
          fi
      
      - name: Push www branch
        run: |
          git push origin www
